#!/usr/bin/env bash

set -euo pipefail

options=autodefrag,compress=lzo
[[ ${INSTALL_SSD:-0} == 1 ]] && options+=ssd,discard

btrfs-subvolumes | while read -r subvol; do
    mnt=/mnt/${subvol#@}
    mkdir -p "$mnt"
    mount -o "$options,subvol=$subvol" "$INSTALL_ROOT_DEVICE" "$mnt"
done
