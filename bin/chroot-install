#!/usr/bin/env bash

set -eu

if [[ -d $CONFIG_DIR/files ]]; then
    rsync -rv "$CONFIG_DIR"/files/ "$INSTALL_DIR"
fi

if ((INSTALL_NET_HAS_WIRELESS)); then
    rsync -rv /var/lib/iwd/ "$INSTALL_DIR"/var/lib/iwd
fi

ln -sfv /run/systemd/resolve/stub-resolv.conf "$INSTALL_DIR"/etc/resolv.conf

export REFLECTOR_COUNTRY=$INSTALL_COUNTRY
template-install /etc/xdg/reflector/reflector.conf

chroot-script-exec "$INSTALL_DIR" "$CONFIG_DIR"/install
