#!/usr/bin/env bash

set -euo pipefail

file_name=80-wifi-station.network

config_names=(
    ignore-carrier-loss
    multicast-dns
    required-for-online
    route-metric
)

chroot-target ln -vsfn \
    /usr/lib/systemd/network/"$file_name".example \
    /etc/systemd/network/"$file_name"

for config_name in "${config_names[@]}"; do
    install-template /etc/systemd/network/"$file_name".d/"$config_name".conf
done

rsync -va /var/lib/iwd/ \
    "$BOOTSTRAP_TARGET_MOUNT_DIR"/var/lib/iwd/

chroot-target systemctl -v enable iwd.service
