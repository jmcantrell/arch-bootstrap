#!/usr/bin/env bash

set -eu

if ((${INSTALL_EFI:-0})); then
    mkfs.fat -F32 "$INSTALL_BOOT_DEVICE"
fi

mkfs.btrfs --label root "$INSTALL_ROOT_DEVICE"

mkdir -p "$INSTALL_DIR"

mount "$INSTALL_ROOT_DEVICE" "$INSTALL_DIR"

while read -r subvol _; do
    btrfs subvolume create "$INSTALL_DIR/$subvol"
done <./config/subvolumes

umount "$INSTALL_DIR"
