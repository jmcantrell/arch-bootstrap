#!/usr/bin/env bash

set -eu

while read -r name path; do
    mnt_path=$INSTALL_DIR/${path#/}
    mkdir -p "$mnt_path"
    mount -o "${INSTALL_FS_MOUNT_OPTIONS:+$INSTALL_FS_MOUNT_OPTIONS,}subvol=$name" "$INSTALL_ROOT_DEVICE" "$mnt_path"
done <"$CONFIG_DIR"/subvolumes

if [[ $INSTALL_BOOT_TYPE == uefi ]]; then
    uefi_dir=$INSTALL_DIR/${INSTALL_BOOT_UEFI_DIR#/}
    mkdir -p "$uefi_dir"
    mount "$INSTALL_BOOT_DEVICE" "$uefi_dir"
fi
