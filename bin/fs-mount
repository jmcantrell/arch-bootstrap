#!/usr/bin/env bash

set -euo pipefail

while read -r subvol mnt; do
    mnt=/mnt/${mnt#/}
    mkdir -p "$mnt"
    mount -o autodefrag,compress=zstd,subvol="$subvol" "$INSTALL_ROOT_DEVICE" "$mnt"
done <"$BOOTSTRAP_DIR"/config/subvolumes

if ((${INSTALL_EFI:-0})); then
    mkdir -p /mnt/boot/efi
    mount "$INSTALL_BOOT_DEVICE" /mnt/boot/efi
fi
