#!/usr/bin/env bash

set -eu

mkdir -p "$INSTALL_DIR"

while read -r subvol dir; do
    mnt_dir=$INSTALL_DIR/${dir#/}
    mkdir -p "$mnt_dir"
    mount -o autodefrag,compress=zstd,subvol="$subvol" "$INSTALL_ROOT_DEVICE" "$mnt_dir"
done <"$CONFIG_DIR"/subvols

if [[ -v INSTALL_EFI_DIR ]]; then
    mkdir -p "$INSTALL_EFI_DIR"
    mount "$INSTALL_BOOT_DEVICE" "$INSTALL_EFI_DIR"
fi
