#!/usr/bin/env bash

set -euo pipefail

if [[ -v BOOTSTRAP_PACKAGE_REPO_DIR ]]; then
    set-package-repo "$BOOTSTRAP_PACKAGE_REPO_DIR"
fi

pacman-key --init
pacman-key --populate
pacman --sync --refresh --needed --noconfirm archlinux-keyring

readarray -t packages < <(print-packages)

pacstrap "$BOOTSTRAP_TARGET_MOUNT_DIR" "${packages[@]}"
