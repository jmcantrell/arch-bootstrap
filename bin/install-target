#!/usr/bin/env bash

set -euo pipefail

create-partitions

if ((BOOTSTRAP_USE_LUKS)); then
    create-luks
    open-luks
fi

create-lvm

if ((BOOTSTRAP_USE_SWAP)); then
    create-lvm-swap
    create-swap
    open-swap
fi

create-lvm-root
create-root
open-root

if [[ $BOOTSTRAP_BOOT_FIRMWARE == uefi ]]; then
    create-uefi
    open-uefi
fi

config-boot
config-initrd

if ((BOOTSTRAP_USE_LUKS)); then
    config-luks
    install-luks-keyfile
fi

install-packages

config-lvm

if ((BOOTSTRAP_USE_TRIM)); then
    config-trim
fi

config-network

if ((BOOTSTRAP_USE_WIRELESS)); then
    config-wireless
fi

config-hostname
config-timezone
config-ntp
config-lang
config-keymap
config-mirrors
config-admin
config-ssh

install-locale
install-fstab
install-boot
