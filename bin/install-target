#!/usr/bin/env bash

set -euo pipefail

create-partitions

if [[ -v BOOTSTRAP_ENABLE_LUKS ]]; then
    create-luks
    open-luks
fi

if [[ $BOOTSTRAP_BOOT_FIRMWARE == uefi ]]; then
    create-uefi
    open-uefi
fi

if [[ -v BOOTSTRAP_ENABLE_LVM ]]; then
    create-lvm
    create-lvm-swap
    create-lvm-root
fi

if [[ -v BOOTSTRAP_ENABLE_SWAP ]]; then
    create-swap
    open-swap
fi

create-root
open-root

if [[ -v BOOTSTRAP_ENABLE_LUKS ]]; then
    install-luks-keyfile
fi

config-boot
config-initrd

install-packages

if [[ -v BOOTSTRAP_ENABLE_LVM ]]; then
    config-lvm
fi

if [[ -v BOOTSTRAP_ENABLE_TRIM ]]; then
    config-trim
fi

if [[ -v BOOTSTRAP_HOSTNAME ]]; then
    config-hostname
fi

if [[ -v BOOTSTRAP_TIMEZONE ]]; then
    config-timezone
fi

config-locale
config-console
config-network
config-mirrors
config-ntp
config-ssh

if [[ -v BOOTSTRAP_ENABLE_WIRELESS ]]; then
    config-wireless
fi

install-locales
install-fstab
install-boot

config-admin
