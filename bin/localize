#!/usr/bin/env bash

set -euo pipefail

timedatectl
hwclock --systohc

if [[ -v INSTALL_KEYMAP ]]; then
    loadkeys "$INSTALL_KEYMAP"
fi

if [[ -v INSTALL_FONT ]]; then
    setfont "$INSTALL_FONT"
fi

# Update the pacman mirrorlist, if possible.
if ping -q -w1 -c1 1.1.1.1 &>/dev/null; then
    reflector \
        --save /etc/pacman.d/mirrorlist \
        --protocol https --latest 5 --sort age \
        --country "$INSTALL_REFLECTOR_COUNTRY"
else
    # If there's no network, stop trying to update it automatically.
    systemctl stop reflector.service
fi
