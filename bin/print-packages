#!/usr/bin/env bash

set -euo pipefail

exec > >(sort -u)

cd "$BOOTSTRAP_CONFIG_DIR"/packages

cat base \
    "$BOOTSTRAP_BOOT_FIRMWARE_PACKAGE_FILE" \
    "$BOOTSTRAP_CPU_VENDOR_PACKAGE_FILE"

if ((BOOTSTRAP_USE_LUKS)); then
    cat luks
fi

if ((BOOTSTRAP_USE_WIRELESS)); then
    cat wireless
fi

if [[ -v BOOTSTRAP_EXTRA_PACKAGES ]]; then
    read -ra packages <<<"$BOOTSTRAP_EXTRA_PACKAGES"
    printf "%s\n" "${packages[@]}"
fi

if [[ -f extra ]]; then
    cat extra
fi
