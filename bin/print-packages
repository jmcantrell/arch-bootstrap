#!/usr/bin/env bash

set -euo pipefail

exec > >(sort -u)

cd "$BOOTSTRAP_CONFIG_DIR"/packages

files=(base)

if [[ -v BOOTSTRAP_BOOT_FIRMWARE_PACKAGE_FILE ]]; then
    files+=("$BOOTSTRAP_BOOT_FIRMWARE_PACKAGE_FILE")
fi

if [[ -v BOOTSTRAP_CPU_VENDOR_PACKAGE_FILE ]]; then
    files+=("$BOOTSTRAP_CPU_VENDOR_PACKAGE_FILE")
fi

if [[ -v BOOTSTRAP_FS_ROOT_PACKAGE_FILE ]]; then
    files+=("$BOOTSTRAP_FS_ROOT_PACKAGE_FILE")
fi

if [[ -v BOOTSTRAP_ENABLE_LUKS ]]; then
    files+=(luks)
fi

if [[ -v BOOTSTRAP_ENABLE_LVM ]]; then
    files+=(lvm)
fi

if [[ -v BOOTSTRAP_ENABLE_WIRELESS ]]; then
    files+=(wireless)
fi

if [[ -f extra ]]; then
    files+=(extra)
fi

cat "${files[@]}"
