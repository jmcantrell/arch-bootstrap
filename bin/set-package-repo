#!/usr/bin/env bash

set -euo pipefail

config_file=${1:?missing config file}
repo_name=${2:?missing repo name}
repo_server=${3:?missing repo server}

sed -Ei '/^\[(core|core-testing|extra|extra-testing|multilib|multilib-testing)\]$/,/^$/s/^./#&/' "$config_file"

if grep -qxF "[$repo_name]" "$config_file"; then
    printf "%s: repository already exists: %s\n" "$0" "$repo_name" >&2
    exit 2
fi

cat >>"$config_file" <<EOF
[$repo_name]
SigLevel = Optional
Server = $repo_server
EOF
