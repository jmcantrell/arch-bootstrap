export BOOTSTRAP_ROOT_DIR=$PWD
export BOOTSTRAP_LIB_DIR=$BOOTSTRAP_ROOT_DIR/lib
export BOOTSTRAP_CONFIG_DIR=$BOOTSTRAP_ROOT_DIR/config

export PATH=$BOOTSTRAP_ROOT_DIR/bin:$PATH

source "$BOOTSTRAP_LIB_DIR"/prepare/target.bash

: "${BOOTSTRAP_TARGET_DEVICE:?}"

source "$BOOTSTRAP_LIB_DIR"/prepare/secure.bash
source "$BOOTSTRAP_LIB_DIR"/prepare/swap.bash
source "$BOOTSTRAP_LIB_DIR"/prepare/hardware.bash
source "$BOOTSTRAP_LIB_DIR"/prepare/partitions.bash
source "$BOOTSTRAP_LIB_DIR"/prepare/file_system.bash
source "$BOOTSTRAP_LIB_DIR"/prepare/chroot.bash

if [[ -v BOOTSTRAP_ENABLE_LUKS ]]; then
    source "$BOOTSTRAP_LIB_DIR"/prepare/luks.bash
fi

if [[ -v BOOTSTRAP_ENABLE_LVM ]]; then
    source "$BOOTSTRAP_LIB_DIR"/prepare/lvm.bash
fi

export BOOTSTRAP_BOOT_DEVICE=$BOOTSTRAP_PART_BOOT_DEVICE

if [[ -v BOOTSTRAP_ENABLE_LVM ]]; then
    export BOOTSTRAP_ROOT_DEVICE=$BOOTSTRAP_LVM_LV_ROOT_MAPPER_DEVICE
elif [[ -v BOOTSTRAP_ENABLE_LUKS ]]; then
    export BOOTSTRAP_ROOT_DEVICE=$BOOTSTRAP_LUKS_MAPPER_DEVICE
else
    export BOOTSTRAP_ROOT_DEVICE=$BOOTSTRAP_PART_SYS_DEVICE
fi

if [[ -v BOOTSTRAP_ENABLE_SWAP ]]; then
    if [[ -v BOOTSTRAP_ENABLE_LVM ]]; then
        export BOOTSTRAP_SWAP_DEVICE=$BOOTSTRAP_LVM_LV_SWAP_MAPPER_DEVICE
    else
        export BOOTSTRAP_SWAP_DEVICE=$BOOTSTRAP_PART_SWAP_DEVICE
    fi
fi

# vi:ft=bash
