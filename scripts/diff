#!/usr/bin/env bash

set -euo pipefail

templates_dir=$PWD/config/templates

changed=0

while IFS= read -r template_file; do
    system_file=/${template_file#"$templates_dir"/}
    if [[ -f $system_file ]]; then
        diff --recursive --no-dereference --unified --color \
            "$system_file" "$template_file" || changed=1
    fi
done < <(find "$templates_dir" -type f)

exit "$changed"
